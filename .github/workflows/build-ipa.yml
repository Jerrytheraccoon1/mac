name: iOS Build

on:
  push:
    branches: [main]

jobs:
  build:
    runs-on: macos-latest

    steps:
    - uses: actions/checkout@v3

    - name: Install Homebrew
      run: /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

    - name: Install XcodeGen
      run: brew install xcodegen

    - name: Generate Xcode project
      run: xcodegen generate

    - name: Resolve Swift Packages
      run: xcodebuild -resolvePackageDependencies -project VentApp.xcodeproj

    - name: Build App
      run: xcodebuild -scheme VentApp -project VentApp.xcodeproj -sdk iphoneos -configuration Release build

    - name: Archive
      run: xcodebuild -scheme VentApp -project VentApp.xcodeproj -archivePath $PWD/build/VentApp.xcarchive archive

    - name: Export IPA
      run: xcodebuild -exportArchive -archivePath $PWD/build/VentApp.xcarchive -exportOptionsPlist ExportOptions.plist -exportPath $PWD/build
